<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Mermaid TestSlides Diagram Demo</title>
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=" />
    <style>
      div.mermaid {
        font-family: 'Courier New', Courier, monospace !important;
      }
    </style>
  </head>

  <body>
    <h1>TestSlides Diagram Demo</h1>

    <div>
      <textarea id="arrayInput" rows="20" cols="70">
testslides
array
@ 1 &blue&
@ 2
@ 3
@ 4
@ 5
array
@ 1
@ 2 &blue&
@ 3
@ 4
@ 5
array
@ 1
@ 2
@ 3 &blue&
@ 4
@ 5
array
@ 1
@ 2
@ 3 
@ 4 &blue&
@ 5
array
@ 1
@ 2
@ 3 
@ 4 
@ 5 &blue&</textarea
      >
      <br />
      <button id="renderButton">Render Diagram</button>
    </div>

    <div class="diagrams">
      <div id="mermaidDiagram" class="mermaid"></div>
    </div>

    <script type="module">
      import mermaid from '/mermaid.esm.mjs';

      async function renderDiagram() {
        const input = document.getElementById('arrayInput').value;
        const { svg } = await mermaid.render('dynamicDiagram', input);
        document.getElementById('mermaidDiagram').innerHTML = svg;

        // Inject page-switching logic as inline JavaScript
        const switchPageScript = `
          (function() {
            const svg = document.getElementById('dynamicDiagram');
            let currentPage = 0;
            const totalPages = ${document.querySelectorAll('g.page').length};
            console.log('totalPages', totalPages);

            document.querySelector('#prevButtonGroup').addEventListener('click', function() {
              console.log('Prev button clicked');
              if (currentPage > 0) {
                currentPage -= 1;
                renderPage(currentPage);
              }
            });

            document.querySelector('#nextButtonGroup').addEventListener('click', function() {
              console.log('Next button clicked');
              if (currentPage < totalPages - 1) {
                currentPage += 1;
                renderPage(currentPage);
              }
            });

            function renderPage(pageIndex) {
              const pages = svg.querySelectorAll('g.page');
              pages.forEach(page => {
                page.style.display = 'none';
              });
              svg.querySelector('#page' + pageIndex).style.display = 'inline';

              const prevButton = svg.querySelector('#prevButton');
              const nextButton = svg.querySelector('#nextButton');
              
              if (prevButton) prevButton.setAttribute('fill', pageIndex > 0 ? '#007bff' : '#c0c0c0');
              if (nextButton) nextButton.setAttribute('fill', pageIndex < totalPages - 1 ? '#007bff' : '#c0c0c0');
            }

            renderPage(currentPage);
          })();
        `;

        // Append the script element to the document
        const scriptElement = document.createElement('script');
        scriptElement.type = 'text/javascript';
        scriptElement.text = switchPageScript;
        document.body.appendChild(scriptElement);
      }

      document.getElementById('renderButton').addEventListener('click', async () => {
        await renderDiagram();
      });

      window.onload = async () => {
        await renderDiagram();
      };

      mermaid.initialize({
        startOnLoad: true,
        logLevel: 3,
        securityLevel: 'loose',
      });
    </script>

    <style>
      .diagrams {
        display: flex;
        flex-wrap: wrap;
      }
      #arrayInput {
        width: 50vw;
        padding: 1em;
      }
      #mermaidDiagram {
        width: 45vw;
        padding: 2em;
      }
    </style>
  </body>
</html>
